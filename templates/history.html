{% extends "base.html" %}
{% block content %}
<h1>💭 Saved Dream Analyses</h1>

<div style="overflow-x:auto;">
<table style="margin:auto; border-collapse:collapse; width:90%; background:white; border-radius:10px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,0.1);">
    <thead>
        <tr style="background:#007BFF; color:white;">
            <th style="padding:12px;">Dream</th>
            <th style="padding:12px;">Primary Emotion</th>
            <th style="padding:12px;">Secondary Emotion</th>
            <th style="padding:12px;">Confidence (Primary)</th>
            <th style="padding:12px;">Confidence (Secondary)</th>
            <th style="padding:12px;">Analyzed On</th>
            <th style="padding:12px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for dream in dreams %}
        <tr style="text-align:center; border-bottom:1px solid #ddd;">
            <td style="padding:10px;">{{ dream['dream'] }}</td>
            <td style="padding:10px;">{{ dream['analysis']['primary_emotion'] }}</td>
            <td style="padding:10px;">{{ dream['analysis']['secondary_emotion'] }}</td>
            <td style="padding:10px;">{{ dream['analysis']['confidence_primary'] }}</td>
            <td style="padding:10px;">{{ dream['analysis']['confidence_secondary'] }}</td>
            <td style="padding:10px;">{{ dream['timestamp'] }}</td>
            <td style="padding:10px;">
    <div class="action-container">
        <!-- 👁️ View Button -->
        <button class="icon-btn view-btn" title="View Details"
                onclick="openModal('{{ dream['_id'] }}')">
            <i class="fas fa-eye"></i>
        </button>

        <!-- ✏️ Edit Button -->
        <a href="{{ url_for('edit_dream', dream_id=dream['_id']) }}" 
           class="icon-btn edit-btn" 
           title="Edit Dream">
            <i class="fas fa-edit"></i>
        </a>

        <form action="{{ url_for('delete_dream', dream_id=str(dream['_id'])) }}" 
              method="POST" 
              style="display:inline;">
            <button type="submit" 
                    class="icon-btn delete-btn" 
                    title="Delete Dream"
                    onclick="return confirm('Are you sure you want to delete this dream?');">
                <i class="fas fa-trash-alt"></i>
            </button>
        </form>

    </div>

    <!-- 💭 Dream Modal -->
    <div id="modal-{{ dream['_id'] }}" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('{{ dream['_id'] }}')">&times;</span>
            <h2>💭 Dream Details</h2>
            <p><strong>Dream:</strong> {{ dream['dream'] }}</p>
            <hr>
            <p><strong>Primary Emotion:</strong> {{ dream['analysis']['primary_emotion'] }}</p>
            <p><strong>Secondary Emotion:</strong> {{ dream['analysis']['secondary_emotion'] }}</p>
            <p><strong>Confidence (Primary):</strong> {{ dream['analysis']['confidence_primary'] }}</p>
            <p><strong>Confidence (Secondary):</strong> {{ dream['analysis']['confidence_secondary'] }}</p>
            <p><strong>Analyzed On:</strong> {{ dream['timestamp'] }}</p>
            <h3>🧠 AI Interpretation</h3>
            <p style="font-style: italic;">{{ dream['interpretation'] }}</p>

        </div>
    </div>
</td>

        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
<script>
function openModal(id) {
    document.getElementById("modal-" + id).style.display = "block";
}
function closeModal(id) {
    document.getElementById("modal-" + id).style.display = "none";
}
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = "none";
    }
};
</script>

{% endblock %}
